<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUMA CLUBS - PLAYER PROFILE</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Specific styles for profile elegance */
        .player-card-header {
            background: var(--fuma-bg-card);
            border: var(--fuma-border);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .rating-badge-large {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 4rem;
            font-weight: 800;
            color: var(--fuma-primary);
            opacity: 0.2;
        }

        .player-avatar-main {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            border: 4px solid var(--fuma-primary);
            object-fit: cover;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .stats-grid-detailed {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-block {
            background: var(--fuma-bg-card);
            border: var(--fuma-border);
            border-radius: 15px;
            padding: 20px;
            transition: transform 0.3s ease;
        }

        .stat-block:hover {
            transform: translateY(-5px);
            border-color: var(--fuma-primary);
        }

        .stat-block h3 {
            color: var(--fuma-primary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .stat-label { color: var(--fuma-text-dim); }
        .stat-value { font-weight: 600; color: #fff; }
        .stat-value.highlight { color: var(--fuma-primary); font-size: 1.1rem; }

        .season-filter-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        #season-selector {
            background: #1a1a1a;
            color: white;
            border: 1px solid var(--fuma-primary);
            padding: 10px 20px;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="fuma-wrapper">
    <nav class="fuma-nav" id="main-nav"></nav>

    <div class="fuma-container" style="margin-top: 50px;">
        
        <div class="season-filter-container">
            <label for="season-selector" style="margin-right: 15px; align-self: center; color: var(--fuma-text-dim);">Season:</label>
            <select id="season-selector">
                <option value="1342244083">All Seasons</option>
                <option value="2074996595">Season 1</option>
                <option value="1996803561">Season 2</option>
            </select>
        </div>

        <div id="player-header">
            <div class="fuma-loading-wrapper" style="text-align: center; padding: 50px;">
                <div class="fuma-spinner" style="margin: 0 auto 15px;"></div>
                <p style="color: var(--fuma-primary); letter-spacing: 2px;">FETCHING PROFILE...</p>
            </div>
        </div>

        <section class="fuma-section">
            <h2 class="fuma-section-title">Performance Analysis</h2>
            <div id="player-stats-container" class="stats-grid-detailed">
                </div>
        </section>
        
        <div style="text-align: center; margin-top: 40px; margin-bottom: 60px;">
            <a href="players.html" class="fuma-cta" style="background: transparent; border: 1px solid var(--fuma-primary); color: var(--fuma-primary);">
    <i class="fas fa-arrow-left"></i> BACK TO LIST
</a>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const playerId = params.get('id');
        const seasonSelector = document.getElementById('season-selector');

        if (playerId) {
            // Initial load (All seasons by default)
            loadPlayerData(playerId, seasonSelector.value);

            // Season change
            seasonSelector.addEventListener('change', (e) => {
                loadPlayerData(playerId, e.target.value);
            });
        } else {
            document.getElementById('player-header').innerHTML = `
                <div class="player-card-header">
                    <p>No player ID specified.</p>
                </div>`;
        }
    });

    async function loadPlayerData(id, gid) {
        const header = document.getElementById('player-header');
        const statsContainer = document.getElementById('player-stats-container');
        
        const PLAYERS_SHEET_BASE = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSjnFfFWUPpHaWofmJ6UUEfw9VzAaaqTnS2WGm4pDSZxfs7FfEOOEfMprH60QrnWgROdrZU-s5VI9rR/pub?single=true&output=csv&gid=';

        try {
            const resp = await fetch(`${PLAYERS_SHEET_BASE}${gid}`);
            const text = await resp.text();
            const lines = text.trim().split("\n");
            const headers = lines[0].split(",").map(h => h.trim());

            const parseCSVLine = (line) => {
                const result = [];
                let cell = '';
                let inQuotes = false;
                for (let i = 0; i < line.length; i++) {
                    let char = line[i];
                    if (char === '"') inQuotes = !inQuotes;
                    else if (char === ',' && !inQuotes) { result.push(cell); cell = ''; }
                    else cell += char;
                }
                result.push(cell);
                return result.map(v => v.replace(/^"|"$/g, '').trim());
            };

            const players = lines.slice(1).map(line => {
                const values = parseCSVLine(line);
                let p = {};
                headers.forEach((h, i) => p[h] = values[i]);
                return p;
            });

            const player = players.find(p => p.GAME_ID === id || p.GAME_TAG === id);

            if (player) {
                renderProfile(player);
            } else {
                header.innerHTML = "<p style='text-align:center;'>Data not found for this season.</p>";
                statsContainer.innerHTML = "";
            }
        } catch (e) {
            console.error(e);
            header.innerHTML = "<p style='text-align:center; color:red;'>Error while loading data.</p>";
        }
    }

    function renderProfile(p) {
        const header = document.getElementById('player-header');
        const statsContainer = document.getElementById('player-stats-container');

        // Header
        header.innerHTML = `
            <div class="player-card-header">
               <img src="${p.AVATAR || 'https://i.ibb.co/4wPqLKzf/profile-picture-icon-png-people-person-profile-4.png'}" 
                     class="player-avatar-main" 
                     onerror="this.src='https://i.ibb.co/KcQsBkmB/3715527-image-profil-icon-male-icon-human-or-people-sign-and-symbol-vector-vectoriel-removebg-previe.png'">
                <h1 style="font-size: 2.8rem; margin: 0; color: #fff; text-transform: uppercase;">
                    ${p.GAME_TAG} ${p.FLAG || ''}
                </h1>
                <p style="color: var(--fuma-primary); letter-spacing: 4px; font-weight: 600; margin-top: 10px;">
                    ${p.MAIN_POSITION || 'N/A'} | ${p.MAIN_ARCHETYPE || 'Standard'}
                </p>
                <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-top: 25px;">
                    <img src="${p.LOGO || ''}" style="height: 45px; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));">
                    <span style="font-size: 1.3rem; font-weight: 300;">${p.CURRENT_TEAM || 'Free Agent'}</span>
                </div>
            </div>
        `;

        // Detailed Statistics
        statsContainer.innerHTML = `
            <div class="stat-block">
                <h3><i class="fas fa-info-circle"></i> General</h3>
                <div class="stat-row">
                    <span class="stat-label">Matches Played</span>
                    <span class="stat-value">${p.GAME_PLAYED || '0'}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Average Rating</span>
                    <span class="stat-value highlight">${p.RATING || '0.0'}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Cards</span>
                    <span class="stat-value">${p.CARDS || '0'}</span>
                </div>
            </div>

            <div class="stat-block">
                <h3><i class="fas fa-fire"></i> Attack</h3>
                <div class="stat-row">
                    <span class="stat-label">Goals</span>
                    <span class="stat-value highlight">${p.GOALS || '0'}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Assists</span>
                    <span class="stat-value highlight">${p.ASSISTS || '0'}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Shots</span>
                    <span class="stat-value">${p.SHOTS || '0'}</span>
                </div>
            </div>

            <div class="stat-block">
                <h3><i class="fas fa-share-alt"></i> Distribution</h3>
                <div class="stat-row">
                    <span class="stat-label">Successful Passes</span>
                    <span class="stat-value">${p.SUCCESSFUL_PASSES || '0'}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Pass Accuracy</span>
                    <span class="stat-value">${p['%SUCCESSFUL_PASSES'] || '0%'}</span>
                </div>
            </div>

            <div class="stat-block">
                <h3><i class="fas fa-shield-alt"></i> Defense</h3>
                <div class="stat-row">
                    <span class="stat-label">Successful Tackles</span>
                    <span class="stat-value">${p.SUCCESSFUL_TACKLES || '0'}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Tackle Accuracy</span>
                    <span class="stat-value">${p['%SUCCESSFUL_TACKLES'] || '0%'}</span>
                </div>
            </div>
        `;
    }
</script>
</body>
</html>
